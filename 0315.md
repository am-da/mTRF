


<br> 

# 1. heatmapの値について

<details><summary>詳細</summary>

```Python
print("mean_coefs.shape", mean_coefs.shape)
print("mean_coefs",mean_coefs)

# 列の値を足し合わせる
summed_values = np.sum(mean_coefs, axis=1)

print("summed_values.shape",summed_values.shape)
print("summed_values",summed_values)
```
<img width="739" alt="スクリーンショット 2024-03-11 10 47 13" src="https://github.com/am-da/mTRF/assets/112613519/1eaccd12-4fbd-4689-b2af-1182569a97bb">
</details>

<br> 

# 2. 32以降のchannel

<img width="900" alt="スクリーンショット 2024-03-12 13 35 48" src="https://github.com/am-da/mTRF/assets/112613519/a1be7172-fe25-47b4-a52d-609c6f7ab722">


# 3. ICA  

## 3.1. パラメータ

・パラメータの数値の設定の仕方は？  
・除くものの決め方は？  create_eog_epochsでは、デフォルトでは、rawに含まれるEOGタイプのチャンネルが使用される(今回はない)

<details><summary>パラメータ(mne.preprocessing.create_eog_epochs)</summary>
https://mne.tools/dev/generated/mne.preprocessing.create_eog_epochs.html

<img width="739" alt="スクリーンショット 2024-03-12 18 24 19" src="https://github.com/am-da/mTRF/assets/112613519/f0443fc2-419b-462c-aa01-8f2f56a2119e">
</details>


<details><summary>パラメータ(mne.preprocessing.ICA)</summary>

https://mne.tools/stable/generated/mne.preprocessing.ICA.html

```Python
ica = mne.preprocessing.ICA(n_components= 20, random_state= 10, max_iter=100)
```

### n_components
  ・float (0~1) : 各成分がデータセット内の分散（情報）のどれだけを説明できるか
  (例：3つの成分があり、最初の成分が70%、2番目が20%、3番目が残りの10%の分散を説明。ここで0.8を指定すると、説明される分散の80%に対応。この場合、最初の2つの成分が選択され、分散の90%が説明される。)  
  
  <img width="684" alt="スクリーンショット 2024-03-12 14 29 48" src="https://github.com/am-da/mTRF/assets/112613519/94bb23f2-9632-4b1b-851e-c5ea980a221c">

### random_state
アルゴリズムは最初にランダムな状態から始まる。　　
そのため、同じデータを使っても、異なる初期状態からスタートすると、異なる成分が見つかることがある。　　

これを防ぐために、random_stateという設定がある。　　
これを設定すると、アルゴリズムが使用するランダムな開始点が固定される。　　
つまり、同じrandom_stateを使うと、同じ成分が見つかる。　　
これにより、同じデータに対して常に同じ結果が得られ、研究の信頼性が高まりる。


</details>


 <br> 
 
## 3.2. EOGを使用して独立成分分析

<details><summary>EOG1のみをトリガーとしてエポックを作成した場合 (n_components= 25, random_state = 23, method='fastica')</summary>
  
<img width="500" alt="スクリーンショット 2024-03-12 17 57 43" src="https://github.com/am-da/mTRF/assets/112613519/00c621ee-7722-44f8-ae53-73dda47281be">
</details>

 <br> 

<details><summary>EOG1 & EOG2 (n_components= 25, random_state = 23, method='fastica')</summary>
  
<img width="500" alt="スクリーンショット 2024-03-12 18 02 01" src="https://github.com/am-da/mTRF/assets/112613519/751bf9af-3e01-49fa-a243-96764a1510c7"> </details>

 <br> 
<details><summary>参考</summary>
  
<img width="909" alt="スクリーンショット 2024-03-12 13 25 57" src="https://github.com/am-da/mTRF/assets/112613519/96950e59-dec8-441f-b1d1-7a667bf1d302">
</details>

 <br> 
 
<details><summary>EOG1 & EOG2 の元の波形</summary>
<img width="1198" alt="スクリーンショット 2024-03-12 18 18 48" src="https://github.com/am-da/mTRF/assets/112613519/b86a4d4f-bd23-430d-9d89-005308bbde04">
</details>

  <br> 
  
<details><summary>コード</summary>

```Python


import mne

from mne.preprocessing import create_eog_epochs,create_ecg_epochs

#easycap_montage = mne.channels.make_standard_montage("biosemi32")

raw = mne.io.read_raw_bdf('/Users/ami/PycharmProjects/UCSD_pycharm/UCSD/DEAP_data/data_original/s01.bdf', preload=True)
# EOGチャンネル名を変更する
raw.rename_channels(mapping={'EXG1': 'EOG1', 'EXG2': 'EOG2'})
# 脳波のチャンネルのインデックスを指定
brain_channels = list(range(0, 32))

# 脳波のチャンネルのみを選択してデータを作成
raw_brain = raw.copy().pick_channels([raw.ch_names[i] for i in brain_channels])
# 33番目と34番目のチャンネルをEOGチャンネルとして登録
print(raw_brain.ch_names)

# デジタルフィルタリング
raw_brain.filter(1, 50, fir_design='firwin')

# ダウンサンプリング（128Hzにダウンサンプリング）
raw_brain.resample(128)

# 平均リファレンスを適用
raw_brain.set_eeg_reference('average', projection=True)
raw_brain.apply_proj()



# ICA

# set up and fit the ICA
reject=dict(mag=4e-12, grad=4000e-13)
ica = mne.preprocessing.ICA(n_components= 25, random_state = 23, method='fastica')

picks_eeg = mne.pick_types(raw_brain.info, eeg = True)
ica.fit(raw_brain, picks = picks_eeg, reject=reject)
print("ica",ica)

ica.plot_components()
eog_epochs = create_eog_epochs(raw_brain, ch_name= ['EOG1','EOG2'])
#print("eog_epochs",eog_epochs)

eog_inds,scores=ica.find_bads_eog(eog_epochs, ch_name= ['EOG1','EOG2'])

print(eog_inds)
print("scores",scores)
ica.plot_scores(scores)

# 変更
#start_time = 321.1542969
#end_time = start_time + 60

#raw_brain.crop(tmin=start_time, tmax=end_time)  # 指定した時間帯のデータを抽出
#raw_brain.plot()
```

</details>




 <br> 
 
 <br> 
 

















